"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.URI = void 0;
const did_jwt_1 = require("did-jwt");
const PresentationExchange_1 = require("../authorization-response/PresentationExchange");
const helpers_1 = require("../helpers");
const request_object_1 = require("../request-object");
const types_1 = require("../types");
const AuthorizationRequest_1 = require("./AuthorizationRequest");
const Payload_1 = require("./Payload");
class URI {
    constructor({ scheme, encodedUri, encodingFormat, authorizationRequestPayload, requestObjectJwt }) {
        this._scheme = scheme;
        this._encodedUri = encodedUri;
        this._encodingFormat = encodingFormat;
        this._authorizationRequestPayload = authorizationRequestPayload;
        this._requestObjectJwt = requestObjectJwt;
    }
    static fromUri(uri) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!uri) {
                throw Error(types_1.SIOPErrors.BAD_PARAMS);
            }
            const { scheme, requestObjectJwt, authorizationRequestPayload, registrationMetadata } = yield URI.parseAndResolve(uri);
            const requestObjectPayload = requestObjectJwt ? (0, did_jwt_1.decodeJWT)(requestObjectJwt).payload : undefined;
            if (requestObjectPayload) {
                (0, request_object_1.assertValidRequestObjectPayload)(requestObjectPayload);
            }
            const result = new URI({
                scheme,
                encodingFormat: types_1.UrlEncodingFormat.FORM_URL_ENCODED,
                encodedUri: uri,
                authorizationRequestPayload,
                requestObjectJwt,
            });
            result._registrationMetadataPayload = registrationMetadata;
            return result;
        });
    }
    /**
     * Create a signed URL encoded URI with a signed SIOP request token on RP side
     *
     * @param opts Request input data to build a  SIOP Request Token
     * @remarks This method is used to generate a SIOP request with info provided by the RP.
     * First it generates the request payload and then it creates the signed JWT, which is returned as a URI
     *
     * Normally you will want to use this method to create the request.
     */
    static fromOpts(opts) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!opts) {
                throw Error(types_1.SIOPErrors.BAD_PARAMS);
            }
            const authorizationRequest = yield AuthorizationRequest_1.AuthorizationRequest.fromOpts(opts);
            return yield URI.fromAuthorizationRequest(authorizationRequest);
        });
    }
    toAuthorizationRequest() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield AuthorizationRequest_1.AuthorizationRequest.fromUriOrJwt(this);
        });
    }
    get requestObjectBy() {
        if (!this.requestObjectJwt) {
            return { passBy: types_1.PassBy.NONE };
        }
        if (this.authorizationRequestPayload.request_uri) {
            return { passBy: types_1.PassBy.REFERENCE, reference_uri: this.authorizationRequestPayload.request_uri };
        }
        return { passBy: types_1.PassBy.VALUE };
    }
    get metadataObjectBy() {
        if (!this.authorizationRequestPayload.registration_uri && !this.authorizationRequestPayload.registration) {
            return { passBy: types_1.PassBy.NONE };
        }
        if (this.authorizationRequestPayload.registration_uri) {
            return { passBy: types_1.PassBy.REFERENCE, reference_uri: this.authorizationRequestPayload.registration_uri };
        }
        return { passBy: types_1.PassBy.VALUE };
    }
    /**
     * Create a URI from the request object, typically you will want to use the createURI version!
     *
     * @remarks This method is used to generate a SIOP request Object with info provided by the RP.
     * First it generates the request object payload, and then it creates the signed JWT.
     *
     * Please note that the createURI method allows you to differentiate between OAuth2 and OpenID parameters that become
     * part of the URI and which become part of the Request Object. If you generate a URI based upon the result of this method,
     * the URI will be constructed based on the Request Object only!
     */
    static fromRequestObject(requestObject) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!requestObject) {
                throw Error(types_1.SIOPErrors.BAD_PARAMS);
            }
            return yield URI.fromAuthorizationRequestPayload(requestObject.options, yield AuthorizationRequest_1.AuthorizationRequest.fromUriOrJwt(yield requestObject.toJwt()));
        });
    }
    static fromAuthorizationRequest(authorizationRequest) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!authorizationRequest) {
                throw Error(types_1.SIOPErrors.BAD_PARAMS);
            }
            return yield URI.fromAuthorizationRequestPayload(Object.assign(Object.assign({}, authorizationRequest.options.requestObject), { version: authorizationRequest.options.version, uriScheme: authorizationRequest.options.uriScheme }), authorizationRequest.payload, authorizationRequest.requestObject);
        });
    }
    /**
     * Creates an URI Request
     * @param opts Options to define the Uri Request
     * @param authorizationRequestPayload
     *
     */
    static fromAuthorizationRequestPayload(opts, authorizationRequestPayload, requestObject) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!authorizationRequestPayload) {
                if (!requestObject || !(yield requestObject.getPayload())) {
                    throw Error(types_1.SIOPErrors.BAD_PARAMS);
                }
                authorizationRequestPayload = {}; // No auth request payload, so the eventual URI will contain a `request_uri` or `request` value only
            }
            const isJwt = typeof authorizationRequestPayload === 'string';
            const requestObjectJwt = requestObject
                ? yield requestObject.toJwt()
                : typeof authorizationRequestPayload === 'string'
                    ? authorizationRequestPayload
                    : authorizationRequestPayload.request;
            if (isJwt && (!requestObjectJwt || !requestObjectJwt.startsWith('ey'))) {
                throw Error(types_1.SIOPErrors.NO_JWT);
            }
            const requestObjectPayload = requestObjectJwt ? (0, did_jwt_1.decodeJWT)(requestObjectJwt).payload : undefined;
            if (requestObjectPayload) {
                // Only used to validate if the request object contains presentation definition(s)
                yield PresentationExchange_1.PresentationExchange.findValidPresentationDefinitions(Object.assign(Object.assign({}, authorizationRequestPayload), requestObjectPayload));
                (0, request_object_1.assertValidRequestObjectPayload)(requestObjectPayload);
                if (requestObjectPayload.registration) {
                    (0, Payload_1.assertValidRPRegistrationMedataPayload)(requestObjectPayload.registration);
                }
            }
            const uniformAuthorizationRequestPayload = typeof authorizationRequestPayload === 'string' ? requestObjectPayload : authorizationRequestPayload;
            if (!uniformAuthorizationRequestPayload) {
                throw Error(types_1.SIOPErrors.BAD_PARAMS);
            }
            const type = opts.passBy;
            if (!type) {
                throw new Error(types_1.SIOPErrors.REQUEST_OBJECT_TYPE_NOT_SET);
            }
            const authorizationRequest = yield AuthorizationRequest_1.AuthorizationRequest.fromUriOrJwt(requestObjectJwt);
            let scheme;
            if (opts.uriScheme) {
                scheme = opts.uriScheme.endsWith('://') ? opts.uriScheme : `${opts.uriScheme}://`;
            }
            else if (opts.version) {
                if (opts.version === types_1.SupportedVersion.JWT_VC_PRESENTATION_PROFILE_v1) {
                    scheme = 'openid-vc://';
                }
                else {
                    scheme = 'openid://';
                }
            }
            else {
                try {
                    scheme =
                        (yield authorizationRequest.getSupportedVersion()) === types_1.SupportedVersion.JWT_VC_PRESENTATION_PROFILE_v1 ? 'openid-vc://' : 'openid://';
                }
                catch (error) {
                    scheme = 'openid://';
                }
            }
            if (type === types_1.PassBy.REFERENCE) {
                if (!opts.reference_uri) {
                    throw new Error(types_1.SIOPErrors.NO_REFERENCE_URI);
                }
                uniformAuthorizationRequestPayload.request_uri = opts.reference_uri;
                delete uniformAuthorizationRequestPayload.request;
            }
            else if (type === types_1.PassBy.VALUE) {
                uniformAuthorizationRequestPayload.request = requestObjectJwt;
                delete uniformAuthorizationRequestPayload.request_uri;
            }
            return new URI({
                scheme,
                encodedUri: `${scheme}?${(0, helpers_1.encodeJsonAsURI)(uniformAuthorizationRequestPayload)}`,
                encodingFormat: types_1.UrlEncodingFormat.FORM_URL_ENCODED,
                // requestObjectBy: opts.requestBy,
                authorizationRequestPayload: uniformAuthorizationRequestPayload,
                requestObjectJwt: requestObjectJwt,
            });
        });
    }
    /**
     * Create a Authentication Request Payload from a URI string
     *
     * @param uri
     */
    static parse(uri) {
        if (!uri) {
            throw Error(types_1.SIOPErrors.BAD_PARAMS);
        }
        // We strip the uri scheme before passing it to the decode function
        const scheme = uri.match(/^([a-zA-Z][a-zA-Z0-9-_]*:\/\/)/g)[0];
        const authorizationRequestPayload = (0, helpers_1.decodeUriAsJson)(uri);
        return { scheme, authorizationRequestPayload };
    }
    static parseAndResolve(uri) {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            if (!uri) {
                throw Error(types_1.SIOPErrors.BAD_PARAMS);
            }
            const { authorizationRequestPayload, scheme } = this.parse(uri);
            const requestObjectJwt = yield (0, helpers_1.fetchByReferenceOrUseByValue)(authorizationRequestPayload.request_uri, authorizationRequestPayload.request, true);
            const registrationMetadata = yield (0, helpers_1.fetchByReferenceOrUseByValue)((_a = authorizationRequestPayload['client_metadata_uri']) !== null && _a !== void 0 ? _a : authorizationRequestPayload['registration_uri'], (_b = authorizationRequestPayload['client_metadata']) !== null && _b !== void 0 ? _b : authorizationRequestPayload['registration']);
            (0, Payload_1.assertValidRPRegistrationMedataPayload)(registrationMetadata);
            return { scheme, authorizationRequestPayload, requestObjectJwt, registrationMetadata };
        });
    }
    get encodingFormat() {
        return this._encodingFormat;
    }
    get encodedUri() {
        return this._encodedUri;
    }
    get authorizationRequestPayload() {
        return this._authorizationRequestPayload;
    }
    get requestObjectJwt() {
        return this._requestObjectJwt;
    }
    get scheme() {
        return this._scheme;
    }
    get registrationMetadataPayload() {
        return this._registrationMetadataPayload;
    }
}
exports.URI = URI;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVVJJLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2F1dGhvcml6YXRpb24tcmVxdWVzdC9VUkkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEscUNBQW9DO0FBRXBDLHlGQUFzRjtBQUN0Rix3Q0FBNEY7QUFDNUYsc0RBQW1GO0FBQ25GLG9DQVdrQjtBQUVsQixpRUFBOEQ7QUFDOUQsdUNBQW1FO0FBR25FLE1BQWEsR0FBRztJQVVkLFlBQW9CLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsMkJBQTJCLEVBQUUsZ0JBQWdCLEVBQW9DO1FBQ3pJLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQzlCLElBQUksQ0FBQyxlQUFlLEdBQUcsY0FBYyxDQUFDO1FBQ3RDLElBQUksQ0FBQyw0QkFBNEIsR0FBRywyQkFBMkIsQ0FBQztRQUNoRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsZ0JBQWdCLENBQUM7SUFDNUMsQ0FBQztJQUVNLE1BQU0sQ0FBTyxPQUFPLENBQUMsR0FBVzs7WUFDckMsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDUixNQUFNLEtBQUssQ0FBQyxrQkFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ3BDO1lBQ0QsTUFBTSxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSwyQkFBMkIsRUFBRSxvQkFBb0IsRUFBRSxHQUFHLE1BQU0sR0FBRyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2SCxNQUFNLG9CQUFvQixHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBRSxJQUFBLG1CQUFTLEVBQUMsZ0JBQWdCLENBQUMsQ0FBQyxPQUFnQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDMUgsSUFBSSxvQkFBb0IsRUFBRTtnQkFDeEIsSUFBQSxnREFBK0IsRUFBQyxvQkFBb0IsQ0FBQyxDQUFDO2FB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